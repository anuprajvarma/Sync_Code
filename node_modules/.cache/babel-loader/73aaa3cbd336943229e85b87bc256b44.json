{"ast":null,"code":"import _regeneratorRuntime from\"/Users/anupraj/Documents/Sync_Code/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/anupraj/Documents/Sync_Code/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/anupraj/Documents/Sync_Code/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from\"react\";import{useLocation,useNavigate,useParams}from\"react-router-dom\";import toast from\"react-hot-toast\";import{initSocket}from\"./socket\";import{DoubtSection}from\"./components/DoubtSection\";import Client from\"./components/Client_avatar\";import logo from\"./images/logo.webp\";import Editor from\"./components/Editor\";import\"./EditorPage.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function EditorPage(){var socketRef=useRef(null);var navigate=useNavigate();var codeRef=useRef(null);var location=useLocation();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),doubt=_useState2[0],setDoubt=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),allDoubts=_useState4[0],setAllDoubts=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isChatShown=_useState6[0],setChatShown=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),liveCode=_useState8[0],onCodeChange=_useState8[1];var data=useParams();var roomId=data.id;var username=location.state.username;var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),clients=_useState10[0],setclients=_useState10[1];var handleChat=function handleChat(e){e.preventDefault();setChatShown(true);};useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return initSocket();case 2:socketRef.current=_context.sent;socketRef.current.emit(\"join_room\",{roomId:roomId,username:username});// Listening for doubt event\nsocketRef.current.on(\"doubt\",function(_ref2){var doubts=_ref2.doubts,username=_ref2.username,socketId=_ref2.socketId;setAllDoubts(doubts);toast.success(\"\".concat(username,\" asked a doubt!\"));});socketRef.current.on(\"joined_user\",function(_ref3){var clients=_ref3.clients,username=_ref3.username,socketId=_ref3.socketId;if(username!==location.state.username){toast.success(\"\".concat(username,\" joined the room.\"));}setclients(clients);socketRef.current.emit(\"sync_code\",{code:codeRef.current,socketId:socketId});});socketRef.current.on(\"disconnected\",function(_ref4){var socketId=_ref4.socketId,username=_ref4.username;toast.success(\"\".concat(username,\" left the room\"));setclients(function(prev){return prev.filter(function(clients){return clients.socketId!==socketId;});});});case 7:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(\"disconnected\");socketRef.current.off(\"joined_user\");};},[]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(clients);_context3.prev=1;_context3.next=4;return window.navigator.clipboard.writeText(roomId);case 4:toast.success(\"Room id has been copied to clipboard!\");_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](1);toast.error(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[1,7]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){navigate(\"/\");toast.success(\"You leaved the Room\");}function askDoubt(_x){return _askDoubt.apply(this,arguments);}function _askDoubt(){_askDoubt=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(e){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:e.preventDefault();socketRef.current.emit(\"doubt\",{roomId:roomId,username:location.state.username,doubt:doubt});setDoubt(\"\");case 3:case\"end\":return _context4.stop();}}},_callee4);}));return _askDoubt.apply(this,arguments);}var downloadTxtFile=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var element,file;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:element=document.createElement(\"a\");file=new Blob([liveCode],{type:\"text/plain\"});element.href=URL.createObjectURL(file);element.download=\"main.txt\";document.body.appendChild(element);element.click();case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function downloadTxtFile(){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:logo,alt:\"\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientList\",children:clients.map(function(item){return/*#__PURE__*/_jsx(Client,{username:item.username},item.socketId);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy Room Id\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;}})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn doubtBtn\",style:{right:\"140px\"},onClick:downloadTxtFile,children:\"Download Code\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn doubtBtn\",onClick:handleChat,children:\"Ask a doubt?\"}),isChatShown&&/*#__PURE__*/_jsx(DoubtSection,{status:setChatShown,setDoubt:setDoubt,doubt:doubt,askDoubt:askDoubt,allDoubts:allDoubts})]});}export default EditorPage;","map":{"version":3,"names":["React","useEffect","useRef","useState","useLocation","useNavigate","useParams","toast","initSocket","DoubtSection","Client","logo","Editor","EditorPage","socketRef","navigate","codeRef","location","doubt","setDoubt","allDoubts","setAllDoubts","isChatShown","setChatShown","liveCode","onCodeChange","data","roomId","id","username","state","clients","setclients","handleChat","e","preventDefault","init","current","emit","on","doubts","socketId","success","code","prev","filter","disconnect","off","copyRoomId","console","log","window","navigator","clipboard","writeText","error","leaveRoom","askDoubt","downloadTxtFile","element","document","createElement","file","Blob","type","href","URL","createObjectURL","download","body","appendChild","click","map","item","right"],"sources":["/Users/anupraj/Documents/Sync_Code/src/EditorPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { useLocation, useNavigate, useParams } from \"react-router-dom\";\nimport toast from \"react-hot-toast\";\nimport { initSocket } from \"./socket\";\nimport { DoubtSection } from \"./components/DoubtSection\";\nimport Client from \"./components/Client_avatar\";\nimport logo from \"./images/logo.webp\";\nimport Editor from \"./components/Editor\";\nimport \"./EditorPage.css\";\n\nfunction EditorPage() {\n  const socketRef = useRef(null);\n  const navigate = useNavigate();\n  const codeRef = useRef(null);\n  const location = useLocation();\n  const [doubt, setDoubt] = useState(\"\");\n  const [allDoubts, setAllDoubts] = useState({});\n  const [isChatShown, setChatShown] = useState(false);\n  const [liveCode, onCodeChange] = useState(\"\");\n  const data = useParams();\n  const roomId = data.id;\n  const username = location.state.username;\n  const [clients, setclients] = useState([]);\n\n  const handleChat = (e) => {\n    e.preventDefault();\n    setChatShown(true);\n  };\n\n  useEffect(() => {\n    const init = async () => {\n      socketRef.current = await initSocket();\n\n      socketRef.current.emit(\"join_room\", { roomId, username });\n\n      // Listening for doubt event\n      socketRef.current.on(\"doubt\", ({ doubts, username, socketId }) => {\n        setAllDoubts(doubts);\n        toast.success(`${username} asked a doubt!`);\n      });\n\n      socketRef.current.on(\"joined_user\", ({ clients, username, socketId }) => {\n        if (username !== location.state.username) {\n          toast.success(`${username} joined the room.`);\n        }\n        setclients(clients);\n\n        socketRef.current.emit(\"sync_code\", {\n          code: codeRef.current,\n          socketId,\n        });\n      });\n\n      socketRef.current.on(\"disconnected\", ({ socketId, username }) => {\n        toast.success(`${username} left the room`);\n        setclients((prev) => {\n          return prev.filter((clients) => clients.socketId !== socketId);\n        });\n      });\n    };\n    init();\n    return () => {\n      socketRef.current.disconnect();\n      socketRef.current.off(\"disconnected\");\n      socketRef.current.off(\"joined_user\");\n    };\n  }, []);\n\n  async function copyRoomId() {\n    console.log(clients);\n    try {\n      await window.navigator.clipboard.writeText(roomId);\n      toast.success(\"Room id has been copied to clipboard!\");\n    } catch (err) {\n      toast.error(err);\n    }\n  }\n  function leaveRoom() {\n    navigate(\"/\");\n    toast.success(\"You leaved the Room\");\n  }\n\n  async function askDoubt(e) {\n    e.preventDefault();\n    socketRef.current.emit(\"doubt\", {\n      roomId,\n      username: location.state.username,\n      doubt,\n    });\n    setDoubt(\"\");\n  }\n\n  const downloadTxtFile = async () => {\n    const element = document.createElement(\"a\");\n    const file = new Blob([liveCode], { type: \"text/plain\" });\n    element.href = URL.createObjectURL(file);\n\n    element.download = \"main.txt\";\n    document.body.appendChild(element);\n    element.click();\n  };\n\n  return (\n    <div className=\"mainWrap\">\n      <div className=\"aside\">\n        <div className=\"asideInner\">\n          <div className=\"logo\">\n            <img className=\"logoImage\" src={logo} alt=\"\" />\n          </div>\n          <h3>Connected</h3>\n          <div className=\"clientList\">\n            {clients.map((item) => (\n              <Client key={item.socketId} username={item.username} />\n            ))}\n          </div>\n        </div>\n        <div className=\"buttons\">\n          <button className=\"btn copyBtn\" onClick={copyRoomId}>\n            Copy Room Id\n          </button>\n          <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n            Leave\n          </button>\n        </div>\n      </div>\n\n      <div className=\"editorWrap\">\n        <Editor\n          socketRef={socketRef}\n          roomId={roomId}\n          onCodeChange={(code) => {\n            codeRef.current = code;\n          }}\n        />\n      </div>\n      <button\n        className=\"btn doubtBtn\"\n        style={{ right: \"140px\" }}\n        onClick={downloadTxtFile}\n      >\n        Download Code\n      </button>\n      <button className=\"btn doubtBtn\" onClick={handleChat}>\n        Ask a doubt?\n      </button>\n      {isChatShown && (\n        <DoubtSection\n          status={setChatShown}\n          setDoubt={setDoubt}\n          doubt={doubt}\n          askDoubt={askDoubt}\n          allDoubts={allDoubts}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default EditorPage;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}