{"ast":null,"code":"import _regeneratorRuntime from\"/Users/anupraj/Documents/Sync_Code/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/anupraj/Documents/Sync_Code/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/anupraj/Documents/Sync_Code/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from\"react\";import{useLocation,useNavigate,useParams}from\"react-router-dom\";import toast from\"react-hot-toast\";import{initSocket}from\"./socket\";import Client from\"./components/Client_avatar\";import logo from\"./images/logo.webp\";import Editor from\"./components/Editor\";import\"./EditorPage.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function EditorPage(){var editorRef=useRef(null);var socketRef=useRef(null);var navigate=useNavigate();var codeRef=useRef(null);var location=useLocation();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),liveCode=_useState2[0],setLiveCode=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),access=_useState4[0],setAccess=_useState4[1];var data=useParams();var roomId=data.id;var username=location.state.username;var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),clients=_useState6[0],setclients=_useState6[1];var _useParams=useParams(),id=_useParams.id;useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return initSocket();case 2:socketRef.current=_context.sent;socketRef.current.emit(\"join_room\",{roomId:roomId,username:username});socketRef.current.on(\"joined_user\",function(_ref2){var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId;if(username!==location.state.username){toast.success(\"\".concat(username,\" joined the room.\"));}setclients(clients);socketRef.current.emit(\"sync_code\",{code:codeRef.current,socketId:socketId});});socketRef.current.on(\"disconnected\",function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room\"));setclients(function(prev){return prev.filter(function(clients){return clients.socketId!==socketId;});});});case 6:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(\"disconnected\");socketRef.current.off(\"joined_user\");};},[]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:console.log(clients);_context3.prev=1;_context3.next=4;return window.navigator.clipboard.writeText(roomId);case 4:toast.success(\"Room id has been copied to clipboard!\");_context3.next=10;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](1);toast.error(_context3.t0);case 10:case\"end\":return _context3.stop();}}},_callee3,null,[[1,7]]);}));return _copyRoomId.apply(this,arguments);}function lockAccess(){return _lockAccess.apply(this,arguments);}function _lockAccess(){_lockAccess=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setAccess(!access);socketRef.current.emit(\"lock_access\",{id:id,access:access});case 2:case\"end\":return _context4.stop();}}},_callee4);}));return _lockAccess.apply(this,arguments);}function leaveRoom(){navigate(\"/\");toast.success(\"You leaved the Room\");}var downloadTxtFile=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var element,file;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:element=document.createElement(\"a\");file=new Blob([liveCode],{type:\"text/plain\"});element.href=URL.createObjectURL(file);// const options = {\n//   method: 'GET',\n//   url: `https://judge0-ce.p.rapidapi.com/languages/${langCode}`,\n//   headers: {\n//     'X-RapidAPI-Key': `${process.env.REACT_APP_RAPID_API_KEY}`,\n//     'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com'\n//   }\n// };\n// const res = (await axios.request(options)).data;\nelement.download=\"main.txt\";document.body.appendChild(element);element.click();case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function downloadTxtFile(){return _ref4.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",src:logo,alt:\"\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientList\",children:clients.map(function(item){return/*#__PURE__*/_jsx(Client,{username:item.username},item.socketId);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"buttons\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy Room Id\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"editorWrap\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,id:id,setLiveCode:setLiveCode,access:access,editorRef:editorRef})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn doubtBtn\",style:{right:\"140px\"},onClick:downloadTxtFile,children:\"Download Code\"})]});}export default EditorPage;","map":{"version":3,"names":["React","useEffect","useRef","useState","useLocation","useNavigate","useParams","toast","initSocket","Client","logo","Editor","EditorPage","editorRef","socketRef","navigate","codeRef","location","liveCode","setLiveCode","access","setAccess","data","roomId","id","username","state","clients","setclients","init","current","emit","on","socketId","success","code","prev","filter","disconnect","off","copyRoomId","console","log","window","navigator","clipboard","writeText","error","lockAccess","leaveRoom","downloadTxtFile","element","document","createElement","file","Blob","type","href","URL","createObjectURL","download","body","appendChild","click","map","item","right"],"sources":["/Users/anupraj/Documents/Sync_Code/src/EditorPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport { useLocation, useNavigate, useParams } from \"react-router-dom\";\nimport toast from \"react-hot-toast\";\nimport { initSocket } from \"./socket\";\nimport Client from \"./components/Client_avatar\";\nimport logo from \"./images/logo.webp\";\nimport Editor from \"./components/Editor\";\nimport \"./EditorPage.css\";\n\nfunction EditorPage() {\n  const editorRef = useRef(null);\n  const socketRef = useRef(null);\n  const navigate = useNavigate();\n  const codeRef = useRef(null);\n  const location = useLocation();\n  const [liveCode, setLiveCode] = useState(\"\");\n  const [access, setAccess] = useState(false);\n  const data = useParams();\n  const roomId = data.id;\n  const username = location.state.username;\n  const [clients, setclients] = useState([]);\n  const { id } = useParams();\n\n  useEffect(() => {\n    const init = async () => {\n      socketRef.current = await initSocket();\n\n      socketRef.current.emit(\"join_room\", { roomId, username });\n\n      socketRef.current.on(\"joined_user\", ({ clients, username, socketId }) => {\n        if (username !== location.state.username) {\n          toast.success(`${username} joined the room.`);\n        }\n        setclients(clients);\n\n        socketRef.current.emit(\"sync_code\", {\n          code: codeRef.current,\n          socketId,\n        });\n      });\n\n      socketRef.current.on(\"disconnected\", ({ socketId, username }) => {\n        toast.success(`${username} left the room`);\n        setclients((prev) => {\n          return prev.filter((clients) => clients.socketId !== socketId);\n        });\n      });\n    };\n    init();\n    return () => {\n      socketRef.current.disconnect();\n      socketRef.current.off(\"disconnected\");\n      socketRef.current.off(\"joined_user\");\n    };\n  }, []);\n\n  async function copyRoomId() {\n    console.log(clients);\n    try {\n      await window.navigator.clipboard.writeText(roomId);\n      toast.success(\"Room id has been copied to clipboard!\");\n    } catch (err) {\n      toast.error(err);\n    }\n  }\n  async function lockAccess() {\n    setAccess(!access);\n    socketRef.current.emit(\"lock_access\", {\n      id,\n      access,\n    });\n  }\n\n  function leaveRoom() {\n    navigate(\"/\");\n    toast.success(\"You leaved the Room\");\n  }\n\n  const downloadTxtFile = async () => {\n    const element = document.createElement(\"a\");\n    const file = new Blob([liveCode], { type: \"text/plain\" });\n    element.href = URL.createObjectURL(file);\n    // const options = {\n    //   method: 'GET',\n    //   url: `https://judge0-ce.p.rapidapi.com/languages/${langCode}`,\n    //   headers: {\n    //     'X-RapidAPI-Key': `${process.env.REACT_APP_RAPID_API_KEY}`,\n    //     'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com'\n    //   }\n    // };\n\n    // const res = (await axios.request(options)).data;\n    element.download = \"main.txt\";\n    document.body.appendChild(element);\n    element.click();\n  };\n\n  return (\n    <div className=\"mainWrap\">\n      <div className=\"aside\">\n        <div className=\"asideInner\">\n          <div className=\"logo\">\n            <img className=\"logoImage\" src={logo} alt=\"\" />\n          </div>\n          <h3>Connected</h3>\n          <div className=\"clientList\">\n            {clients.map((item) => (\n              <Client key={item.socketId} username={item.username} />\n            ))}\n          </div>\n        </div>\n        <div className=\"buttons\">\n          <button className=\"btn copyBtn\" onClick={copyRoomId}>\n            Copy Room Id\n          </button>\n          <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n            Leave\n          </button>\n        </div>\n      </div>\n\n      <div className=\"editorWrap\">\n        <Editor\n          socketRef={socketRef}\n          id={id}\n          setLiveCode={setLiveCode}\n          access={access}\n          editorRef={editorRef}\n        />\n      </div>\n      <button\n        className=\"btn doubtBtn\"\n        style={{ right: \"140px\" }}\n        onClick={downloadTxtFile}\n      >\n        Download Code\n      </button>\n    </div>\n  );\n}\n\nexport default EditorPage;\n"],"mappings":"wXAAA,MAAOA,MAAP,EAAgBC,SAAhB,CAA2BC,MAA3B,CAAmCC,QAAnC,KAAmD,OAAnD,CACA,OAASC,WAAT,CAAsBC,WAAtB,CAAmCC,SAAnC,KAAoD,kBAApD,CACA,MAAOC,MAAP,KAAkB,iBAAlB,CACA,OAASC,UAAT,KAA2B,UAA3B,CACA,MAAOC,OAAP,KAAmB,4BAAnB,CACA,MAAOC,KAAP,KAAiB,oBAAjB,CACA,MAAOC,OAAP,KAAmB,qBAAnB,CACA,MAAO,kBAAP,C,wFAEA,QAASC,WAAT,EAAsB,CACpB,GAAMC,UAAS,CAAGX,MAAM,CAAC,IAAD,CAAxB,CACA,GAAMY,UAAS,CAAGZ,MAAM,CAAC,IAAD,CAAxB,CACA,GAAMa,SAAQ,CAAGV,WAAW,EAA5B,CACA,GAAMW,QAAO,CAAGd,MAAM,CAAC,IAAD,CAAtB,CACA,GAAMe,SAAQ,CAAGb,WAAW,EAA5B,CACA,cAAgCD,QAAQ,CAAC,EAAD,CAAxC,wCAAOe,QAAP,eAAiBC,WAAjB,eACA,eAA4BhB,QAAQ,CAAC,KAAD,CAApC,yCAAOiB,MAAP,eAAeC,SAAf,eACA,GAAMC,KAAI,CAAGhB,SAAS,EAAtB,CACA,GAAMiB,OAAM,CAAGD,IAAI,CAACE,EAApB,CACA,GAAMC,SAAQ,CAAGR,QAAQ,CAACS,KAAT,CAAeD,QAAhC,CACA,eAA8BtB,QAAQ,CAAC,EAAD,CAAtC,yCAAOwB,OAAP,eAAgBC,UAAhB,eACA,eAAetB,SAAS,EAAxB,CAAQkB,EAAR,YAAQA,EAAR,CAEAvB,SAAS,CAAC,UAAM,CACd,GAAM4B,KAAI,4FAAG,2JACerB,WAAU,EADzB,QACXM,SAAS,CAACgB,OADC,eAGXhB,SAAS,CAACgB,OAAV,CAAkBC,IAAlB,CAAuB,WAAvB,CAAoC,CAAER,MAAM,CAANA,MAAF,CAAUE,QAAQ,CAARA,QAAV,CAApC,EAEAX,SAAS,CAACgB,OAAV,CAAkBE,EAAlB,CAAqB,aAArB,CAAoC,eAAqC,IAAlCL,QAAkC,OAAlCA,OAAkC,CAAzBF,QAAyB,OAAzBA,QAAyB,CAAfQ,QAAe,OAAfA,QAAe,CACvE,GAAIR,QAAQ,GAAKR,QAAQ,CAACS,KAAT,CAAeD,QAAhC,CAA0C,CACxClB,KAAK,CAAC2B,OAAN,WAAiBT,QAAjB,uBACD,CACDG,UAAU,CAACD,OAAD,CAAV,CAEAb,SAAS,CAACgB,OAAV,CAAkBC,IAAlB,CAAuB,WAAvB,CAAoC,CAClCI,IAAI,CAAEnB,OAAO,CAACc,OADoB,CAElCG,QAAQ,CAARA,QAFkC,CAApC,EAID,CAVD,EAYAnB,SAAS,CAACgB,OAAV,CAAkBE,EAAlB,CAAqB,cAArB,CAAqC,eAA4B,IAAzBC,SAAyB,OAAzBA,QAAyB,CAAfR,QAAe,OAAfA,QAAe,CAC/DlB,KAAK,CAAC2B,OAAN,WAAiBT,QAAjB,oBACAG,UAAU,CAAC,SAACQ,IAAD,CAAU,CACnB,MAAOA,KAAI,CAACC,MAAL,CAAY,SAACV,OAAD,QAAaA,QAAO,CAACM,QAAR,GAAqBA,QAAlC,EAAZ,CAAP,CACD,CAFS,CAAV,CAGD,CALD,EAjBW,sDAAH,kBAAJJ,KAAI,0CAAV,CAwBAA,IAAI,GACJ,MAAO,WAAM,CACXf,SAAS,CAACgB,OAAV,CAAkBQ,UAAlB,GACAxB,SAAS,CAACgB,OAAV,CAAkBS,GAAlB,CAAsB,cAAtB,EACAzB,SAAS,CAACgB,OAAV,CAAkBS,GAAlB,CAAsB,aAAtB,EACD,CAJD,CAKD,CA/BQ,CA+BN,EA/BM,CAAT,CAdoB,QA+CLC,WA/CK,0IA+CpB,0IACEC,OAAO,CAACC,GAAR,CAAYf,OAAZ,EADF,wCAGUgB,OAAM,CAACC,SAAP,CAAiBC,SAAjB,CAA2BC,SAA3B,CAAqCvB,MAArC,CAHV,QAIIhB,KAAK,CAAC2B,OAAN,CAAc,uCAAd,EAJJ,mFAMI3B,KAAK,CAACwC,KAAN,eANJ,sEA/CoB,qDAwDLC,WAxDK,0IAwDpB,0IACE3B,SAAS,CAAC,CAACD,MAAF,CAAT,CACAN,SAAS,CAACgB,OAAV,CAAkBC,IAAlB,CAAuB,aAAvB,CAAsC,CACpCP,EAAE,CAAFA,EADoC,CAEpCJ,MAAM,CAANA,MAFoC,CAAtC,EAFF,wDAxDoB,6CAgEpB,QAAS6B,UAAT,EAAqB,CACnBlC,QAAQ,CAAC,GAAD,CAAR,CACAR,KAAK,CAAC2B,OAAN,CAAc,qBAAd,EACD,CAED,GAAMgB,gBAAe,6FAAG,2JAChBC,OADgB,CACNC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CADM,CAEhBC,IAFgB,CAET,GAAIC,KAAJ,CAAS,CAACrC,QAAD,CAAT,CAAqB,CAAEsC,IAAI,CAAE,YAAR,CAArB,CAFS,CAGtBL,OAAO,CAACM,IAAR,CAAeC,GAAG,CAACC,eAAJ,CAAoBL,IAApB,CAAf,CACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACAH,OAAO,CAACS,QAAR,CAAmB,UAAnB,CACAR,QAAQ,CAACS,IAAT,CAAcC,WAAd,CAA0BX,OAA1B,EACAA,OAAO,CAACY,KAAR,GAhBsB,wDAAH,kBAAfb,gBAAe,2CAArB,CAmBA,mBACE,aAAK,SAAS,CAAC,UAAf,wBACE,aAAK,SAAS,CAAC,OAAf,wBACE,aAAK,SAAS,CAAC,YAAf,wBACE,YAAK,SAAS,CAAC,MAAf,uBACE,YAAK,SAAS,CAAC,WAAf,CAA2B,GAAG,CAAExC,IAAhC,CAAsC,GAAG,CAAC,EAA1C,EADF,EADF,cAIE,iCAJF,cAKE,YAAK,SAAS,CAAC,YAAf,UACGiB,OAAO,CAACqC,GAAR,CAAY,SAACC,IAAD,qBACX,KAAC,MAAD,EAA4B,QAAQ,CAAEA,IAAI,CAACxC,QAA3C,EAAawC,IAAI,CAAChC,QAAlB,CADW,EAAZ,CADH,EALF,GADF,cAYE,aAAK,SAAS,CAAC,SAAf,wBACE,eAAQ,SAAS,CAAC,aAAlB,CAAgC,OAAO,CAAEO,UAAzC,0BADF,cAIE,eAAQ,SAAS,CAAC,cAAlB,CAAiC,OAAO,CAAES,SAA1C,mBAJF,GAZF,GADF,cAuBE,YAAK,SAAS,CAAC,YAAf,uBACE,KAAC,MAAD,EACE,SAAS,CAAEnC,SADb,CAEE,EAAE,CAAEU,EAFN,CAGE,WAAW,CAAEL,WAHf,CAIE,MAAM,CAAEC,MAJV,CAKE,SAAS,CAAEP,SALb,EADF,EAvBF,cAgCE,eACE,SAAS,CAAC,cADZ,CAEE,KAAK,CAAE,CAAEqD,KAAK,CAAE,OAAT,CAFT,CAGE,OAAO,CAAEhB,eAHX,2BAhCF,GADF,CA0CD,CAED,cAAetC,WAAf"},"metadata":{},"sourceType":"module"}